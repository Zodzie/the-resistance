<html>
    <head>
        <style type="text/css">
        </style>

        <script src="/socket.io/socket.io.js"></script>
        <script src="/static/jquery.min.js"></script>
        <script src="/static/underscore-min.js"></script>
        <script>

            function getCookie(key) {
                var cookies = document.cookie.split(";");
                for (var i = 0; i < cookies.length; i++) {
                    var parts = cookies[i].trim().split("=");
                    if (parts[0]===key) {
                        return parts[1];
                    }
                }
            }
            
            // initiate a WebSocket connection to the server using Socket.io
            var socket = io.connect("/");
            
            // incoming chat message event: add it to the page's message list
            socket.on("msg", function(data) {
                $("#messages").prepend("<div>" + data + "</div>");
            });
            
            socket.on("showgame", function(gamecode) {
                window.location = "/game/" + gamecode;
            });
            
            socket.on("connect", function() {
                socket.emit("session", getCookie("sessionid"));
            });
            
            $(function() {
                
                $("#chatbox").keydown(function(ev) {
                    if (ev.which==13 && $(this).val()) {
                        socket.emit("msg", $(this).val());
                        $(this).val("");
                    }
                }).focus(); // focus the chatbox so user can type

                $("#setname").keydown(function(ev) {
                    if (ev.which==13 && $(this).val()) {
                        socket.emit("name", $(this).val());
                        $(this).val("");
                    }
                });
                
                $("#newgame").click(function(ev) {
                    socket.emit("creategame");
                })

            });

        </script>
    </head>

    <body>
        <input type="text" id="chatbox" size="100" placeholder="Chat!"/>
        <input type="text" id="setname" size="30" placeholder="Set your name"/>
        <button id="newgame">New game</button>
        <div id="messages"></div>
    </body>

</html>
